# This composite action is included in other workflows to have a shared setup
# for java, gradle, caches, etc.

name: Prepare Lucene build
description: Creates a shared setup for other workflows

inputs:
  java-version:
    required: false
    default: "25"
    description: "The default JDK version to set up."

  java-distribution:
    required: false
    default: "temurin"
    description: "The default JDK distribution type"

  use-cache:
    required: false
    default: true
    description: "Use setup-gradle for dependency caching"

runs:
  using: "composite"
  steps:
    - name: Set up Java (${{ inputs.java-distribution }}, ${{ inputs.java-version }})"
      uses: actions/setup-java@be666c2fcd27ec809703dec50e508c2fdc7f6654 # v5.2.0
      with:
        distribution: ${{ inputs.java-distribution }}
        java-version: ${{ inputs.java-version }}
        java-package: jdk

    - name: Cache gradle-wrapper.jar
      if: ${{ fromJSON(inputs.use-cache) }}
      uses: actions/cache@cdf6c1fa76f9f475f3d7449005a359c84ca0f306 # v5.0.3
      with:
        path: gradle/wrapper/gradle-wrapper.jar
        key: gradle-wrapper-${{ hashFiles('gradle/wrapper/gradle-wrapper.jar.sha256') }}

    # This includes "smart" caching of gradle dependencies.
    - name: Set up Gradle
      if: ${{ fromJSON(inputs.use-cache) }}
      uses: gradle/actions/setup-gradle@f29f5a9d7b09a7c6b29859002d29d24e1674c884 # v5.0.1
      with:
        # increase expiry time for the temp. develocity token.
        # https://github.com/gradle/actions/blob/main/docs/setup-gradle.md#increasing-the-expiry-time-for-develocity-access-tokens
        develocity-token-expiry: 8
